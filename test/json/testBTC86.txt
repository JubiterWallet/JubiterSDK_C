https://www.blockchain.com/btc/tx/777c998695de4b7ecec54c058c73b2cab71184cf1655840935cd9388923dc288

// a p2wpkh tx to a p2tr address(bc1pveaamy78cq5hvl74zmfw52fxyjun3lh7lgt44j03ygx02zyk8lesgk06f6)
02000000 version
00 // marker
01 // flag
01 // input count
  // preout-hash index scipt-sig sequence
  fe9d111c806dbf9fa4f03869a42ff81972691b86db5c3ef89381456b4422d3be 00000000 00 ffffffff
02 // output count
  // amount  script-public-key
  3075000000000000 225120667bdd93c7c029767fd516d2ea292624b938fefefa175ac9f1220cf508963ff3
  0000000000000000 116a0f676d20746170726f6f7420f09fa595
02 // witness#1
  47
    30 44
      02 20 01ce176bf7357e12a873b4e439d53eb02f1a642a043a6b7e9e5ae46d0d152f8c
      02 20 4d603e93f49205624eb56c686fc759cc8d11000f4df76c24bda62d790f13d1ff
     01
  2102e484e53bcce92e801a29454dae07812d6999bf1133aca94c8b03c65b56bdd08d
00000000 //locktime

https://www.blockchain.com/btc/tx/2eb8dbaa346d4be4e82fe444c2f0be00654d8cfd8c4a9a61b11aeaab8c00b272
// a p2tr tx (script path spending)
01000000 // version
00 // marker
01 // flag
02 // input count
  // preout-hash index script-sig sequence
  2373cf02ce7df6500ae46a4a0fbbb1b636d2debed8f2df91e2415627397a3409 00000000 00 fdffffff
  88c23d928893cd3509845516cf8411b7cab2738c054cc5ce7e4bde9586997c77 00000000 00 fdffffff
02 // output count
  // amount script-public-key
  0000000000000000 2b6a29676d20746170726f6f7420f09fa5952068747470733a2f2f626974636f696e6465766b69742e6f7267
  6e9e110000000000 1976a91405070d0290da457409a37db2e294c1ffbc52738088ac
04 // witness#1
  410adf90fd381d4a13c3e73740b337b230701189ed94abcb4030781635f035e6d3b50b8506470a68292a2bc74745b7a5732a28254b5f766f09e495929ec308090b01
  00
  4620c13e6d193f5d04506723bd67abcc5d31b610395c445ac6744cb0a1846b3aabaeac20b0e2e48ad7c3d776cf6f2395c504dc19551268ea7429496726c5d5bf72f9333cba519c
  21c00000000000000000000000000000000000000000000000000000000000000001
04 // witness#2
  414636070d21adc8280735383102f7a0f5978cea257777a23934dd3b458b79bf388aca218e39e23533a059da173e402c4fc5e3375e1f839efb22e9a5c2a815b07301
  00
  4620c13e6d193f5d04506723bd67abcc5d31b610395c445ac6744cb0a1846b3aabaeac20b0e2e48ad7c3d776cf6f2395c504dc19551268ea7429496726c5d5bf72f9333cba519c
  21c00000000000000000000000000000000000000000000000000000000000000001
00000000 // lockTime

// verify p2tr tx
https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki#script-validation-rules

// Let q be the 32-byte array containing the witness program
// program of pre output
q = 667bdd93c7c029767fd516d2ea292624b938fefefa175ac9f1220cf508963ff3

// tag hash
tag_TpaLeaf  = sha256("TapLeaf")  = aeea8fdc4208983105734b58081d1e2638d35f1cb54008d4d357ca03be78e9ee
tag_TapTweak = sha256("TapTweak") = e80fe1639c9ca050e3af1b39c143c63e429cbceb15d940fbb5c5a1f4af57c5e9

s = [20c13e6d193f5d04506723bd67abcc5d31b610395c445ac6744cb0a1846b3aabaeac20b0e2e48ad7c3d776cf6f2395c504dc19551268ea7429496726c5d5bf72f9333cba519c]
c = c00000000000000000000000000000000000000000000000000000000000000001
m = 0
p = c[1:33] = 0000000000000000000000000000000000000000000000000000000000000001
P = lift_x(int(p))
  = (1, 4218F20AE6C646B363DB68605822FB14264CA8D2587FDD6FBC750D587E76A7EE)
v = c[0]    = c0
k0 = hash_TapLeaf(v||compact_size(s)||s)
   = hash_TapLeaf(
       c0||
       46||
       20c13e6d193f5d04506723bd67abcc5d31b610395c445ac6744cb0a1846b3aabaeac20b0e2e48ad7c3d776cf6f2395c504dc19551268ea7429496726c5d5bf72f9333cba519c
     )
   = 4d25540984c296d24b3f2184bfb4ef4513e73d158e2e63d1f5f1bdf9c20ebfa9
t = hash_TapTweak(p||k0)
  = hash_TapTweak(
      0000000000000000000000000000000000000000000000000000000000000001||
      4d25540984c296d24b3f2184bfb4ef4513e73d158e2e63d1f5f1bdf9c20ebfa9
    )
  = 4053dac158a0c0ed8ac410c0ab6a973386ae0521abc146bd787bdaf19b9b04bf
Q = P + t * G
  = (1, 4218F20AE6C646B363DB68605822FB14264CA8D2587FDD6FBC750D587E76A7EE) +
    (3fc7af27ac50756994d1c6108e2675cd43ca11134a2b68bc941d69c4cb7276e7,
     57adc1aa45e7df36d16f94b4bd006ec8d0f35a639a9615c940c10fdeca7e6544)
  = (667bdd93c7c029767fd516d2ea292624b938fefefa175ac9f1220cf508963ff3,
     beb460a849e1efc2d39f78f7a538ddcd526e4b247d87373bd4a4ebc6ada9348c)

x(Q) = 667bdd93c7c029767fd516d2ea292624b938fefefa175ac9f1220cf508963ff3
y(Q) = beb460a849e1efc2d39f78f7a538ddcd526e4b247d87373bd4a4ebc6ada9348c

q == x(Q)
// c[0] = c0
c[0] & 1 == y(Q)%2  == 0

// script validation success

https://www.blockchain.com/btc/tx/33e794d097969002ee05d336686fc03c9e15a597c1b9827669460fac98799036
// a p2tr tx (key path spending)

01000000 // version
00 // marker
01 // flag
01
  d1f1c1f8cdf6759167b90f52c9ad358a369f95284e841d7a2536cef31c054958 01000000 00 fdffffff
02
  #1 output OP_RETURN '/I like Schnorr sigs and I cannot lie. @bitbug42'
  0000000000000000 31 6a 2f49206c696b65205363686e6f7272207369677320616e6420492063616e6e6f74206c69652e20406269746275673432
  #2 output p2tr
  9e06010000000000 22 51 20 a37c3903c8d0db6512e2b40b0dffa05e5a3ab73603ce8c9c4b7771e5412328f9
01 #1 witness (r, s)
  40 a60c383f71bac0ec919b1d7dbc3eb72dd56e7aa99583615564f9f99b8ae4e837 b758773a5b2e4c51348854c8389f008e05029db7f464a5ff2e01d5e6e626174a
ffd30a00 // locktime

verify

// SigMsg(hash_type, ext_flag)

len(sig) = 0x40
hash_type = 0x00 //default hash type

// SigMsg(0x00, 0)
Control:
  hash_type: 00
Transaction data:
  version: 01000000
  nLockTime: ffd30a00
  // 0x00&0x80 not equal SIGHASH_ANYONECANPAY
  sha_prevouts: cc49ade8dbd7cc06fa7763c53ad7e79a0030bce4958cea94d46566053dd8a3dc = sha256(d1f1c1f8cdf6759167b90f52c9ad358a369f95284e841d7a2536cef31c05495801000000)

  // NOT amount of outputs. IS intputs amounts spend by this tx
  // in https://www.blockchain.com/btc/tx/5849051cf3ce36257a1d844e28959f368a35adc9520fb9679175f6cdf8c1f1d1
  sha_amounts:  b346ac905a5f0e863d3a8fa47c18df8a26ff5a63a01f212414f1d37cf14b4acb = sha256(a059010000000000)
  // NOT scriptpubkey of outputs. IS inputs lock scripts
  // in https://www.blockchain.com/btc/tx/5849051cf3ce36257a1d844e28959f368a35adc9520fb9679175f6cdf8c1f1d1
  sha_scriptpubkeys: 48f58118a4bde743ab3a07a3bd3b133b370bdae6ba01fae001859ef0267d4fd9 = sha256(225120339ce7e165e67d93adb3fef88a6d4beed33f01fa876f05a225242b82a631abc0)
  sha_sequences: 23e9829bfb4e23fbd3c4848baa035af15d73bcb83e510f7f097f90a21a4280d2 = sha256(fdffffff)
  // 0x00&0x03 not equal SIGHASH_NONE or SIGHASH_SINGLE
  sha_outputs: ddc468ad3e113c76adf193dcbbf1d3c0eeebc25b9dffbe22217da7d565638904 = sha256(0000000000000000316a2f49206c696b65205363686e6f7272207369677320616e6420492063616e6e6f74206c69652e204062697462756734329e06010000000000225120a37c3903c8d0db6512e2b40b0dffa05e5a3ab73603ce8c9c4b7771e5412328f9)

Data about #1 input:
  send_type: 00
  // // 0x00&0x80 not equal SIGHASH_ANYONECANPA
  // // not use
  // outpoint: <empty>
  // amount: <empty>
  // scriptPubKey: <empty>
  // sequence: <empty>
  //  use index
  index: 00000000

SigMsg = 0001000000ffd30a00cc49ade8dbd7cc06fa7763c53ad7e79a0030bce4958cea94d46566053dd8a3dcb346ac905a5f0e863d3a8fa47c18df8a26ff5a63a01f212414f1d37cf14b4acb48f58118a4bde743ab3a07a3bd3b133b370bdae6ba01fae001859ef0267d4fd923e9829bfb4e23fbd3c4848baa035af15d73bcb83e510f7f097f90a21a4280d2ddc468ad3e113c76adf193dcbbf1d3c0eeebc25b9dffbe22217da7d5656389040000000000

digest = hash_TapSighash(00||sig_msg)
       = 0b984c26fb08d5389fa1997f01e5371a5ceda5e710ff228cf2b6096aad4c3c2f
pub = 339ce7e165e67d93adb3fef88a6d4beed33f01fa876f05a225242b82a631abc0
sig = a60c383f71bac0ec919b1d7dbc3eb72dd56e7aa99583615564f9f99b8ae4e837b758773a5b2e4c51348854c8389f008e05029db7f464a5ff2e01d5e6e626174a

// use https://raw.githubusercontent.com/bitcoin/bips/master/bip-0340/reference.py
verify success
